services:
    {{ victoriametrics_container_name }}:
        container_name: {{ victoriametrics_container_name }}
        image: {{ victoriametrics_image }}
        restart: unless-stopped
        labels:
        - "traefik.enable=true"
        - "traefik.http.routers.{{ victoriametrics_container_name }}.rule=Host(`{{ victoriametrics_url }}`)"
        - "traefik.http.routers.{{ victoriametrics_container_name }}.entrypoints=websecure"
        - "traefik.http.routers.{{ victoriametrics_container_name }}.tls.certresolver=le"
        - "traefik.http.services.{{ victoriametrics_container_name }}.loadbalancer.server.port={{ victoriametrics_port}}"
        - "traefik.http.routers.{{ victoriametrics_container_name }}.service={{ victoriametrics_container_name }}" 
        command:
        - "--storageDataPath=/storage"
        - "--retentionPeriod=30d"
        - "--promscrape.config={{ scrape_folder }}/scrape.yaml"
        ports:
        - "{{ victoriametrics_port }}:{{ victoriametrics_port }}"
        volumes:
        - "{{ victoriametrics_data }}:/storage"
        - "{{ victoriametrics_dir }}/scrape.yaml:{{ scrape_folder }}/scrape.yaml"
        - "{{ additional_scrape_configs_dir }}:{{ scrape_folder }}/jobs"
        networks:
        - {{ docker_network_name | default('monitoring_network') }}

volumes:
  {{ victoriametrics_data }}:

networks:
  {{ docker_network_name | default('monitoring_network') }}:
    external: true