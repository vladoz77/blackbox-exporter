# Ansible Role: Monitoring üìä

## –û–ø–∏—Å–∞–Ω–∏–µ
**–†–æ–ª—å –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –≤–∫–ª—é—á–∞—é—â–µ–π VictoriaMetrics, Grafana, Alertmanager, Loki –∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.**

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ‚úÖ

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Docker –∏ docker-compose.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ (–≤–∞–∂–Ω—ã–µ) üîß

–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `defaults/main.yaml`.

- `monitoring_enable` (bool) ‚Äî –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ä–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`).
- `docker_network_name` (string) ‚Äî –∏–º—è —Å–µ—Ç–∏ Docker (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `monitoring_network`).
- `victoriametrics_enable` (bool) ‚Äî –≤–∫–ª—é—á–∏—Ç—å VictoriaMetrics (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`).
- `victoriametrics_version` (string) ‚Äî –≤–µ—Ä—Å–∏—è VictoriaMetrics (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `v1.118.0`).
- `grafana_enable` (bool) ‚Äî –≤–∫–ª—é—á–∏—Ç—å Grafana (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`).
- `grafana_version` (string) ‚Äî –≤–µ—Ä—Å–∏—è Grafana (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `11.5.0`).
- `alertmanager_enable` (bool) ‚Äî –≤–∫–ª—é—á–∏—Ç—å Alertmanager (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`).
- `loki_enable` (bool) ‚Äî –≤–∫–ª—é—á–∏—Ç—å Loki (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`).

> –í—Å–µ –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ `defaults/main.yaml`.

---

## –§–∞–π–ª—ã —Ä–æ–ª–∏

- `tasks/main.yaml` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
- `templates/docker-compose.yaml.j2` ‚Äî —à–∞–±–ª–æ–Ω docker-compose –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (playbook) üìã

```yaml
- hosts: monitoring-servers
  become: true
  roles:
    - role: monitoring
      vars:
        monitoring_enable: true
        grafana_enable: true
        victoriametrics_enable: true
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–æ—Ä–æ—Ç–∫–æ) üí°

1. –†–æ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω—ã –ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ docker-compose.

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ üß™

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ –¥–ª—è docker-compose –∏ –≤ –Ω–µ–π –ª–µ–∂–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

---

## –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ üîê

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é.

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ üìÑ

### 1. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è VictoriaMetrics

```yaml
# scrape.yaml

scrape_configs:
  - job_name: 'victoriametrics'
    static_configs:
      - targets: ['localhost:8428']
```

### 2. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è Grafana

```yaml
# datasources.yaml

apiVersion: 1
providers:
  - name: 'Prometheus'
    type: prometheus
    access: proxy
    url: http://victoriametrics:8428
    jsonData:
      httpMethod: POST
```

### 3. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è Alertmanager

```yaml
# alertmanager.yaml

global:
  resolve_timeout: 5m

route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  receiver: 'default'

receivers:
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5000/alerts'
```

---


